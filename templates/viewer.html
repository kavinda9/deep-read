<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI PDF Reader - Viewer</title>
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='images/logo.png') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        overflow: hidden;
      }

      .viewer-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
      }

      .top-navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(
          135deg,
          #160e11 0%,
          #e63946 50%,
          #160e11 100%
        );
        padding: 10px 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }

      .navbar-left {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .logo-container {
        display: flex;
        align-items: center;
      }

      .logo {
        height: 40px;
        width: auto;
      }

      .navbar-back-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        text-decoration: none;
        font-size: 14px;
        transition: background 0.2s;
      }

      .navbar-back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .navbar-right {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .navbar-lang-select {
        padding: 8px 12px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.9);
        font-size: 14px;
        cursor: pointer;
        color: #333;
      }

      .navbar-voice-select {
        padding: 8px 12px 8px 40px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.9);
        font-size: 14px;
        cursor: pointer;
        color: #333;
        min-width: 150px;
        background-repeat: no-repeat;
        background-position: 10px center;
        background-size: 20px 20px;
        background-image: url("{{ url_for('static', filename='images/female.png') }}");
      }

      .navbar-voice-select.male-selected {
        background-image: url("{{ url_for('static', filename='images/male.png') }}");
      }

      .pdf-container {
        flex: 1;
        overflow: hidden;
      }

      #pdfViewer {
        border: none;
        width: 100%;
        height: 100%;
      }

      /* Force black text for all output content */
      .translate-output,
      .summary-output,
      #imageResultContent,
      #imageResultContent p,
      #imageResult,
      #imageResult p {
        color: #000 !important;
      }

      .loading-spinner {
        text-align: center;
        padding: 40px;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="viewer-container">
      <!-- Top Navigation Bar -->
      <div class="top-navbar">
        <div class="navbar-left">
          <div class="logo-container">
            <img
              src="{{ url_for('static', filename='images/symbol.png') }}"
              alt="Logo"
              class="logo"
            />
          </div>
          <a href="/" class="navbar-back-btn">← Back</a>
        </div>

        <div class="navbar-right">
          <!-- Voice Type Selector -->
          <select id="voiceSelect" class="navbar-voice-select">
            <option value="female">Female Voice</option>
            <option value="male">Male Voice</option>
          </select>

          <!-- Language Selector -->
          <select id="languageSelect" class="navbar-lang-select">
            <option value="en">English</option>
            <option value="si">Sinhala (සිංහල)</option>
            <option value="ta">Tamil (தமிழ்)</option>
          </select>
        </div>
      </div>

      <!-- PDF Viewer Container -->
      <div class="pdf-container">
        <iframe
          id="pdfViewer"
          src="{{ url_for('static', filename='pdfjs/web/viewer.html') }}?file={{ url_for('get_pdf', session_id=session_id) }}&session={{ session_id }}"
          width="100%"
          height="100%"
        ></iframe>
      </div>
    </div>

    <script>
      const SESSION_ID = "{{ session_id }}";

      // Language and Voice selector
      window.addEventListener("load", function () {
        const languageSelect = document.getElementById("languageSelect");
        const voiceSelect = document.getElementById("voiceSelect");

        // Load saved language
        const savedLang = sessionStorage.getItem("selectedLanguage") || "en";
        languageSelect.value = savedLang;

        // Load saved voice type
        const savedVoice = sessionStorage.getItem("selectedVoice") || "female";
        voiceSelect.value = savedVoice;

        // Set initial icon based on saved voice
        if (savedVoice === "male") {
          voiceSelect.classList.add("male-selected");
        }

        // Store selected language
        languageSelect.addEventListener("change", function () {
          sessionStorage.setItem("selectedLanguage", this.value);
          console.log("Language changed to:", this.value);
        });

        // Store selected voice type and update icon
        voiceSelect.addEventListener("change", function () {
          sessionStorage.setItem("selectedVoice", this.value);
          console.log("Voice changed to:", this.value);

          if (this.value === "male") {
            this.classList.add("male-selected");
          } else {
            this.classList.remove("male-selected");
          }
        });

        // Set initial values
        sessionStorage.setItem("selectedLanguage", languageSelect.value);
        sessionStorage.setItem("selectedVoice", voiceSelect.value);
      });

      // Cleanup on page unload
      window.addEventListener("beforeunload", () => {
        if (SESSION_ID) {
          fetch("/cleanup/" + SESSION_ID, { method: "POST" }).catch(() => {});
        }
      });
    </script>
  </body>
</html>
